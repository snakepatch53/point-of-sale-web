import{f as _,r as f,S as M,E as R,j as e,s as v,P as O}from"./index-DKYCmnMZ.js";import{g as H}from"./products-rLAu1C-k.js";import{g as X}from"./clients-VDowkfva.js";import{k as z,l as G,m as J}from"./index.es-gRuHa-HP.js";import{B as w}from"./Button-gzgfriZS.js";import{S as U}from"./Search-DvZNMIQ2.js";const K="combo";async function V({data:a}){return await _({resource:K+"/bulkSale",data:a,method:"POST",all:!0,formData:!0})}const C=f.createContext();function W({children:a}){const{session:n}=f.useContext(M),{entity:x}=f.useContext(R),[m,u]=f.useState(null),[i,l]=f.useState(null),[h,b]=f.useState(null),[c,j]=f.useState([]);f.useEffect(()=>{H().then(s=>{u(s.filter(d=>d.stock>0))}),X().then(s=>l(s))},[]);const p=s=>{if(!s)return b(null);const d=i==null?void 0:i.find(t=>{var o,P,q,L,Q,T,A,E,$,B,D,F,I;return((q=(P=(o=t==null?void 0:t.name)==null?void 0:o.toString())==null?void 0:P.toLowerCase())==null?void 0:q.includes(s))||((T=(Q=(L=t==null?void 0:t.name1)==null?void 0:L.toString())==null?void 0:Q.toLowerCase())==null?void 0:T.includes(s))||(($=(E=(A=t==null?void 0:t.lastname)==null?void 0:A.toString())==null?void 0:E.toLowerCase())==null?void 0:$.includes(s))||((F=(D=(B=t==null?void 0:t.lastname2)==null?void 0:B.toString())==null?void 0:D.toLowerCase())==null?void 0:F.includes(s))||((I=t==null?void 0:t.dni)==null?void 0:I.includes(s))});if(!d)return b(null);b(d)},r=()=>{if(c.length<=0)return v({title:"Cancelado",message:"No hay productos para vender",type:"warning"});const s={iva:x.tax,client_id:(h==null?void 0:h.id)||0,user_id:n.id,products:c};V({data:s}).then(d=>{console.log(d)})},g=s=>{const d=c==null?void 0:c.some(t=>t.id===s.id);if(s.stock===0)return v({title:"Cancelado",message:"Producto sin stock",type:"warning"});j(d?t=>t.map(o=>o.id===s.id?{...o,quantity:o.quantity+1}:o):t=>{const o={...s,quantity:1};return t?[...t,o]:[o]}),u(t=>t.map(o=>o.id===s.id?{...o,stock:o.stock-1}:o))},N=s=>{j(d=>d.filter(t=>t.id!==s.id)),u(d=>d.map(t=>t.id===s.id?{...t,stock:t.stock+s.quantity}:t))},S=(s,d)=>{j(t=>t.map(o=>o.id===s.id?{...o,quantity:o.quantity+d}:o)),u(t=>t.map(o=>o.id===s.id?{...o,stock:o.stock-d}:o))},y=s=>{if((m.find(t=>t.id===s.id).stock||0)===0)return v({title:"Cancelado",message:"Producto sin stock",type:"warning"});S(s,1)},k=s=>{if(s.quantity===1)return N(s);S(s,-1)};return e.jsx(C.Provider,{value:{products:m,selectedClient:h,sales:c,addSale:g,removeSale:N,incrementQuantity:y,decrementQuantity:k,sale:r,searchClient:p},children:a})}function ie(){return e.jsx(W,{children:e.jsxs(O,{className:"flex flex-col xl:flex-row w-full p-3 gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx(Y,{})}),e.jsxs("div",{className:"flex-1 flex flex-col gap-3 xl:max-w-[600px] ",children:[e.jsx(Z,{}),e.jsx(ee,{})]})]})})}function Y(){const{products:a,addSale:n}=f.useContext(C),[x,m]=f.useState(null);f.useEffect(()=>{m(a)},[a]);const u=l=>()=>n(l),i=l=>{const h=l.target.value.toString().toLowerCase();if(!h)return m(a);const b=a==null?void 0:a.filter(c=>{var j,p,r,g,N,S,y,k,s;return((r=(p=(j=c==null?void 0:c.name)==null?void 0:j.toString())==null?void 0:p.toLowerCase())==null?void 0:r.includes(h))||((S=(N=(g=c==null?void 0:c.mark)==null?void 0:g.toString())==null?void 0:N.toLowerCase())==null?void 0:S.includes(h))||((s=(k=(y=c==null?void 0:c.category)==null?void 0:y.toString())==null?void 0:k.toLowerCase())==null?void 0:s.includes(h))});m(b)};return e.jsxs("div",{className:"flex-1 flex flex-col gap-4 bg-[--c3] p-4 rounded-md border-solid border-t-2 border-t-[--c3-txt2] ",children:[e.jsx(U,{placeholder:"Busca por código, nombre o categoría",onSearch:i}),e.jsx("div",{className:"grid lg:grid-cols-2 gap-2",children:x==null?void 0:x.map(l=>e.jsx(te,{src:l.photo_url,name:l.name,mark:l.mark,stock:l.stock,price:l.price,onClick:u(l)},l.id))})]})}function Z(){const{searchClient:a,selectedClient:n}=f.useContext(C),x=m=>{const u=m.target.value.toString().toLowerCase();a(u)};return e.jsxs("div",{className:" flex flex-col gap-2 bg-[--c3] p-4 rounded-md border-solid border-t-2 border-t-[--c3-txt2] ",children:[e.jsx(U,{placeholder:"Busca por nombr o cédula",onSearch:x}),!n&&e.jsx("span",{className:"block p-2 rounded-md text-[--c3-txt] text-center opacity-70 border-solid border border-black/30 ",children:"Consumidor final"}),n&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"block p-2 rounded-md text-[--c3-txt] text-center opacity-70 border-solid border border-black/30 ",children:[n==null?void 0:n.name," ",n==null?void 0:n.name2," ",n.lastname," ",n.lastname2]}),e.jsx("span",{className:"block p-2 rounded-md text-[--c3-txt] text-center opacity-70 border-solid border border-black/30 ",children:n==null?void 0:n.dni})]})]})}function ee(){const{sales:a,removeSale:n,incrementQuantity:x,decrementQuantity:m,sale:u}=f.useContext(C),{entity:i}=f.useContext(R),l=a==null?void 0:a.reduce((r,g)=>r+g.price*g.quantity,0),h=l*(i==null?void 0:i.tax)/100,b=l+h,c=r=>()=>n(r),j=r=>()=>m(r),p=r=>()=>x(r);return e.jsxs("div",{className:" flex-1 flex flex-col gap-4 bg-[--c3] p-4 rounded-md border-solid border-t-2 border-t-[--c3-txt2] ",children:[e.jsx("div",{className:" scroll-style overflow-x-auto ",children:e.jsxs("table",{className:"w-full text-center",children:[e.jsx("thead",{className:"text-[--c3-txt2] uppercase ",children:e.jsxs("tr",{children:[e.jsx("th",{className:"font-sans",children:"Producto"}),e.jsx("th",{className:"font-sans",children:"Cantidad"}),e.jsx("th",{className:"font-sans",children:"Precio"}),e.jsx("th",{className:"font-sans",children:"Subtotal"}),e.jsx("th",{className:"font-sans",children:"Acción"})]})}),e.jsxs("tbody",{className:" text-[--c3-txt] ",children:[a==null?void 0:a.map(r=>e.jsx(se,{name:r.name,price:r.price,quantity:r.quantity,onQuantityDown:j(r),onQuantityUp:p(r),onRemove:c(r)},r.id)),(a==null?void 0:a.length)==0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"font-sans opacity-80 py-4",children:"No hay productos en la lista"})})]}),e.jsxs("tfoot",{className:" font-bold text-[--c3-txt2] uppercase ",children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"2"}),e.jsx("td",{className:"font-sans",children:"SUBTOTAL:"}),e.jsxs("td",{className:"font-sans",children:["$",l.toFixed(2)]}),e.jsx("td",{})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:"2"}),e.jsxs("td",{className:"font-sans",children:["TAX (",i==null?void 0:i.tax,"%):"]}),e.jsxs("td",{className:"font-sans",children:["$",h.toFixed(2)]}),e.jsx("td",{})]})]})]})}),e.jsx(w,{as:"button",text:"Cobrar $"+b.toFixed(2),className:"gap-0 bg-[--c1] text-[--c1-txt] ",classText:"font-sans text-md",onClick:u})]})}function te({src:a="https://via.placeholder.com/70",name:n="Nombre del proyecto",mark:x="Marca",stock:m=0,price:u=0,onClick:i}){return e.jsxs("button",{className:"flex gap-2 p-3 bg-[--c3] rounded-md cursor-pointer transition-all hover:scale-[1.03] hover:shadow-lg",onClick:i,children:[e.jsx("div",{className:"h-20 aspect-square rounded-md ",children:e.jsx("img",{src:a,alt:"Producto",className:"w-full h-full object-cover rounded-md bg-[--c3]"})}),e.jsxs("div",{className:"flex-1 flex flex-col items-start overflow-hidden ",children:[e.jsx("h3",{className:" block w-full max-w-full font-sans leading-5 text-left text-lg text-[--c3-txt] text-ellipsis text-nowrap overflow-hidden",children:n}),e.jsx("p",{className:"font-sans text-[--c3-txt2] text-ellipsis leading-5 text-nowrap overflow-hidden opacity-85 ",children:x}),e.jsxs("span",{className:"text-[--c3-txt2] opacity-75 leading-5",children:[e.jsx("b",{className:"font-sans text-sm ",children:"Stock: "}),m]}),e.jsxs("span",{className:"font-josefin font-bold text-xl text-[--c3-txt3] opacity-75 leading-5",children:["$",u]})]})]})}function se({name:a,price:n,quantity:x,onQuantityDown:m,onQuantityUp:u,onRemove:i}){return e.jsxs("tr",{children:[e.jsx("td",{className:"font-sans",children:a}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-center items-center h-8",children:[e.jsx(w,{as:"button",icon:z,className:"aspect-square h-full",onClick:m}),e.jsx("span",{className:"flex justify-center items-center aspect-square h-full font-sans",children:x}),e.jsx(w,{as:"button",icon:G,className:"aspect-square h-full",onClick:u})]})}),e.jsxs("td",{className:"font-sans",children:["$",n]}),e.jsxs("td",{className:"font-sans",children:["$",n*x]}),e.jsx("td",{children:e.jsx("div",{className:"flex justify-center items-center py-1",children:e.jsx(w,{as:"button",icon:J,className:"text-sm aspect-square w-8",onClick:i})})})]})}export{ie as default};
