import{a as R,r as h,S as M,I as U,j as e,s as v,P as O,b as H,d as X,e as z}from"./index-D9Xxbm4X.js";import{g as G}from"./clients-BOvPWVID.js";import{B as k}from"./Button-BS3uwBQQ.js";import{S as _}from"./Search-6GARPoev.js";const J="products";function K(a){return a.map(({...n})=>({...n}))}async function V(){const a=await R({resource:J});return K(a)}const W="combo";async function Y({data:a}){return await R({resource:W+"/bulkSale",data:a,method:"POST",all:!0,formData:!0})}const C=h.createContext();function Z({children:a}){const{session:n}=h.useContext(M),{info:d}=h.useContext(U),[x,m]=h.useState(null),[i,l]=h.useState(null),[f,b]=h.useState(null),[c,j]=h.useState([]);h.useEffect(()=>{V().then(s=>m(s)),G().then(s=>l(s))},[]);const p=s=>{if(!s)return b(null);const u=i==null?void 0:i.find(t=>{var o,P,q,L,Q,T,$,A,B,D,F,I,E;return((q=(P=(o=t==null?void 0:t.name)==null?void 0:o.toString())==null?void 0:P.toLowerCase())==null?void 0:q.includes(s))||((T=(Q=(L=t==null?void 0:t.name1)==null?void 0:L.toString())==null?void 0:Q.toLowerCase())==null?void 0:T.includes(s))||((B=(A=($=t==null?void 0:t.lastname)==null?void 0:$.toString())==null?void 0:A.toLowerCase())==null?void 0:B.includes(s))||((I=(F=(D=t==null?void 0:t.lastname2)==null?void 0:D.toString())==null?void 0:F.toLowerCase())==null?void 0:I.includes(s))||((E=t==null?void 0:t.dni)==null?void 0:E.includes(s))});if(!u)return b(null);b(u)},r=()=>{if(c.length<=0)return v({title:"Cancelado",message:"No hay productos para vender",type:"warning"});const s={iva:d.tax,client_id:(f==null?void 0:f.id)||0,user_id:n.id,products:c};Y({data:s}).then(u=>{console.log(u)})},g=s=>{const u=c==null?void 0:c.some(t=>t.id===s.id);if(s.stock===0)return v({title:"Cancelado",message:"Producto sin stock",type:"warning"});j(u?t=>t.map(o=>o.id===s.id?{...o,quantity:o.quantity+1}:o):t=>{const o={...s,quantity:1};return t?[...t,o]:[o]}),m(t=>t.map(o=>o.id===s.id?{...o,stock:o.stock-1}:o))},N=s=>{j(u=>u.filter(t=>t.id!==s.id)),m(u=>u.map(t=>t.id===s.id?{...t,stock:t.stock+s.quantity}:t))},S=(s,u)=>{j(t=>t.map(o=>o.id===s.id?{...o,quantity:o.quantity+u}:o)),m(t=>t.map(o=>o.id===s.id?{...o,stock:o.stock-u}:o))},y=s=>{if((x.find(t=>t.id===s.id).stock||0)===0)return v({title:"Cancelado",message:"Producto sin stock",type:"warning"});S(s,1)},w=s=>{if(s.quantity===1)return N(s);S(s,-1)};return e.jsx(C.Provider,{value:{products:x,selectedClient:f,sales:c,addSale:g,removeSale:N,incrementQuantity:y,decrementQuantity:w,sale:r,searchClient:p},children:a})}function ie(){return e.jsx(Z,{children:e.jsxs(O,{className:"flex flex-col xl:flex-row w-full p-3 gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx(ee,{})}),e.jsxs("div",{className:"flex-1 flex flex-col gap-3 xl:max-w-[600px] ",children:[e.jsx(te,{}),e.jsx(se,{})]})]})})}function ee(){const{products:a,addSale:n}=h.useContext(C),[d,x]=h.useState(null);h.useEffect(()=>{x(a)},[a]);const m=l=>()=>n(l),i=l=>{const f=l.target.value.toString().toLowerCase();if(!f)return x(a);const b=a==null?void 0:a.filter(c=>{var j,p,r,g,N,S,y,w,s;return((r=(p=(j=c==null?void 0:c.name)==null?void 0:j.toString())==null?void 0:p.toLowerCase())==null?void 0:r.includes(f))||((S=(N=(g=c==null?void 0:c.mark)==null?void 0:g.toString())==null?void 0:N.toLowerCase())==null?void 0:S.includes(f))||((s=(w=(y=c==null?void 0:c.category)==null?void 0:y.toString())==null?void 0:w.toLowerCase())==null?void 0:s.includes(f))});x(b)};return e.jsxs("div",{className:"flex-1 flex flex-col gap-4 bg-[--c3] p-4 rounded-md border-solid border-t-2 border-t-[--c3-txt2] ",children:[e.jsx(_,{placeholder:"Busca por código, nombre o categoría",onSearch:i}),e.jsx("div",{className:"grid lg:grid-cols-2 gap-2",children:d==null?void 0:d.map(l=>e.jsx(ae,{src:l.photo_url,name:l.name,mark:l.mark,stock:l.stock,price:l.price,onClick:m(l)},l.id))})]})}function te(){const{searchClient:a,selectedClient:n}=h.useContext(C),d=x=>{const m=x.target.value.toString().toLowerCase();a(m)};return e.jsxs("div",{className:" flex flex-col gap-2 bg-[--c3] p-4 rounded-md border-solid border-t-2 border-t-[--c3-txt2] ",children:[e.jsx(_,{placeholder:"Busca por nombr o cédula",onSearch:d}),!n&&e.jsx("span",{className:"block p-2 rounded-md text-[--c3-txt] text-center opacity-70 border-solid border border-black/30 ",children:"Consumidor final"}),n&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"block p-2 rounded-md text-[--c3-txt] text-center opacity-70 border-solid border border-black/30 ",children:[n==null?void 0:n.name," ",n==null?void 0:n.name2," ",n.lastname," ",n.lastname2]}),e.jsx("span",{className:"block p-2 rounded-md text-[--c3-txt] text-center opacity-70 border-solid border border-black/30 ",children:n==null?void 0:n.dni})]})]})}function se(){const{sales:a,removeSale:n,incrementQuantity:d,decrementQuantity:x,sale:m}=h.useContext(C),{info:i}=h.useContext(U),l=a==null?void 0:a.reduce((r,g)=>r+g.price*g.quantity,0),f=l*(i==null?void 0:i.tax)/100,b=l+f,c=r=>()=>n(r),j=r=>()=>x(r),p=r=>()=>d(r);return e.jsxs("div",{className:" flex-1 flex flex-col gap-4 bg-[--c3] p-4 rounded-md border-solid border-t-2 border-t-[--c3-txt2] ",children:[e.jsx("div",{className:" scroll-style overflow-x-auto ",children:e.jsxs("table",{className:"w-full text-center",children:[e.jsx("thead",{className:"text-[--c3-txt2] uppercase ",children:e.jsxs("tr",{children:[e.jsx("th",{className:"font-sans",children:"Producto"}),e.jsx("th",{className:"font-sans",children:"Cantidad"}),e.jsx("th",{className:"font-sans",children:"Precio"}),e.jsx("th",{className:"font-sans",children:"Subtotal"}),e.jsx("th",{className:"font-sans",children:"Acción"})]})}),e.jsxs("tbody",{className:" text-[--c3-txt] ",children:[a==null?void 0:a.map(r=>e.jsx(ne,{name:r.name,price:r.price,quantity:r.quantity,onQuantityDown:j(r),onQuantityUp:p(r),onRemove:c(r)},r.id)),(a==null?void 0:a.length)==0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"font-sans opacity-80 py-4",children:"No hay productos en la lista"})})]}),e.jsxs("tfoot",{className:" font-bold text-[--c3-txt2] uppercase ",children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"2"}),e.jsx("td",{className:"font-sans",children:"SUBTOTAL:"}),e.jsxs("td",{className:"font-sans",children:["$",l.toFixed(2)]}),e.jsx("td",{})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:"2"}),e.jsxs("td",{className:"font-sans",children:["TAX (",i==null?void 0:i.tax,"%):"]}),e.jsxs("td",{className:"font-sans",children:["$",f.toFixed(2)]}),e.jsx("td",{})]})]})]})}),e.jsx(k,{as:"button",text:"Cobrar $"+b.toFixed(2),className:"gap-0 bg-[--c1] text-[--c1-txt] ",classText:"font-sans text-md",onClick:m})]})}function ae({src:a="https://via.placeholder.com/70",name:n="Nombre del proyecto",mark:d="Marca",stock:x=0,price:m=0,onClick:i}){return e.jsxs("button",{className:"flex gap-2 p-3 bg-[--c3] rounded-md cursor-pointer transition-all hover:scale-[1.03] hover:border-2 hover:border-[--c3-txt] hover:shadow-lg",onClick:i,children:[e.jsx("div",{className:"h-20 aspect-square rounded-md ",children:e.jsx("img",{src:a,alt:"Producto",className:"w-full h-full object-cover rounded-md bg-[--c3]"})}),e.jsxs("div",{className:"flex-1 flex flex-col items-start overflow-hidden ",children:[e.jsx("h3",{className:" block w-full max-w-full font-sans leading-5 text-left text-lg text-[--c3-txt] text-ellipsis text-nowrap overflow-hidden",children:n}),e.jsx("p",{className:"font-sans text-[--c3-txt2] text-ellipsis leading-5 text-nowrap overflow-hidden opacity-85 ",children:d}),e.jsxs("span",{className:"text-[--c3-txt2] opacity-75 leading-5",children:[e.jsx("b",{className:"font-sans text-sm ",children:"Stock: "}),x]}),e.jsxs("span",{className:"font-josefin font-bold text-xl text-[--c3-txt3] opacity-75 leading-5",children:["$",m]})]})]})}function ne({name:a,price:n,quantity:d,onQuantityDown:x,onQuantityUp:m,onRemove:i}){return e.jsxs("tr",{children:[e.jsx("td",{className:"font-sans",children:a}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-center items-center h-8",children:[e.jsx(k,{as:"button",icon:H,className:"aspect-square h-full",onClick:x}),e.jsx("span",{className:"flex justify-center items-center aspect-square h-full font-sans",children:d}),e.jsx(k,{as:"button",icon:X,className:"aspect-square h-full",onClick:m})]})}),e.jsxs("td",{className:"font-sans",children:["$",n]}),e.jsxs("td",{className:"font-sans",children:["$",n*d]}),e.jsx("td",{children:e.jsx("div",{className:"flex justify-center items-center py-1",children:e.jsx(k,{as:"button",icon:z,className:"text-sm aspect-square w-8",onClick:i})})})]})}export{ie as default};
